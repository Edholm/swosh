<html>
<head>
    <title>Swosh</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    <script>
        function generateLink() {
            document.getElementById("erroralert").style.visibility = 'hidden';
            document.getElementById("cardlinkdiv").style.visibility = 'hidden';

            var phone = document.getElementById("phone").value;
            var amount = document.getElementById("amount").value;
            var msg = document.getElementById("message").value;
            var expire = document.getElementById("expire").value;

            var dto = {phone: phone, amount: amount, message: msg, expireAfterSeconds: expire};
            var http = new XMLHttpRequest();
            http.open("POST", "/api/create", true);
            http.setRequestHeader("Content-Type", "application/json; charset=UTF-8");
            http.onreadystatechange = function () {
                if (http.readyState === 4) {
                    if (http.status === 200) {
                        document.getElementById("cardlinkdiv").style.visibility = '';

                        var resp = JSON.parse(http.responseText);
                        var urlElem = document.getElementById("swoshurl");
                        urlElem.href = resp.url;
                        urlElem.text = resp.url;
                    } else {
                        console.log(http.response);
                        document.getElementById("erroralert").style.visibility = '';
                    }
                }
            };
            http.send(JSON.stringify(dto));
        }

        function copyUrlToClipboard() {
            var aux = document.createElement("input");
            aux.setAttribute("value", document.getElementById("swoshurl").href);
            document.body.appendChild(aux);
            aux.select();
            document.execCommand("copy");
            document.body.removeChild(aux);
        }
    </script>
</head>
<body class="container">
<div class="row">
    <h1>Generate link</h1>
    <div class="card">
        <div class="card-block">
            Fill in the below information to generate a swosh.me link that you can share with your friends
        </div>
    </div>
    <form style="margin-top: 1em">
        <div class="form-group">
            <label for="phone">Recipient's phone number</label>
            <input type="text" class="form-control text-muted" id="phone" placeholder="Phone number">
        </div>
        <div class="form-group">
            <label for="amount">Amount</label>
            <input type="number" min="1" max="125000" class="form-control" id="amount" placeholder="Amount">
        </div>
        <div class="form-group">
            <label for="message">Message</label>
            <input type="text" class="form-control" id="message" placeholder="Message (optional)">
        </div>

        <div class="form-group">
            <label title="The link will stop working after the selected amount of time" for="expire">Expires in</label>
            <select class="form-control" id="expire">
                <option value="604800">1 week</option>
                <option value="86400">1 day</option>
                <option value="43200">12 hours</option>
                <option value="3600">1 hour</option>
                <option value="1800">30 minutes</option>
                <option value="600">10 minutes</option>
                <option value="">Never</option>
            </select>
        </div>
        <button type="button" class="btn btn-primary" onclick="generateLink()">Generate link</button>
    </form>
</div>
</div>
<div class="row">
    <div class="alert alert-danger" role="alert" id="erroralert"
         style="float: left; position: absolute; visibility: hidden">
        <strong>Oh snap!</strong> Change a few things up and try submitting again.
    </div>
    <div class="card" id="cardlinkdiv" style="visibility: hidden">
        <h3 class="card-header">Your swosh url</h3>
        <div class="card-block">
            <a href="#" id="swoshurl">https://swosh.me/herp</a>
            <button style="margin-left: 1em" class="btn btn-secondary" title="Copy to clipboard"
                    onclick="copyUrlToClipboard()">
                <i class="fa fa-clipboard" aria-hidden="true"></i>
            </button>
        </div>
    </div>
</div>
<hr>
<div class="row justify-content-left">
    <div class="col">
        <a href="https://github.com/Edholm/swosh" class="btn btn-secondary"><i class="fa fa-github" aria-hidden="true">
            Swosh on Github</i></a>
    </div>
</div>
</body>
</html>
